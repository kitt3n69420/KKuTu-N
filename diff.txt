[replace] Public 40:41 -> Lib 40:41 (BrokenFix: False)
--- Public ---
var BAD = new RegExp(["느으*[^가-힣]*금마?", "니[^가-힣]*(엄|앰|엠)", "(ㅄ|ㅅㅂ|ㅂㅅ)", "미친(년|놈)?", "(병|븅|빙)[^가-힣]*신", "보[^가-힣]*지", "(새|섀|쌔|썌)[^가-힣]*(기|끼)", "섹[^가-힣]*스", "(시|씨|쉬|쒸)이*입?[^가-힣]*(발|빨|벌|뻘|팔|펄)", "십[^가-힣]*새", "씹", "(애|에)[^가-힣]*미", "자[^가-힣]*지", "존[^가-힣]*나", "좆|죶", "지랄", "창[^가-힣]*(녀|년|놈)", "fuck", "sex"].join('|'), "g");

--- Lib ---
var BAD = new RegExp(["\ub290\uc73c*[^\uac00-\ud7a3]*\uae08\ub9c8?", "\ub2c8[^\uac00-\ud7a3]*(\uc5c4|\uc570|\uc5e0)", "(\u3144|\u3145\u3142|\u3142\u3145)", "\ubbf8\uce5c(\ub144|\ub188)?", "(\ubcd1|\ube05|\ube59)[^\uac00-\ud7a3]*\uc2e0", "\ubcf4[^\uac00-\ud7a3]*\uc9c0", "(\uc0c8|\uc100|\uc314|\uc34c)[^\uac00-\ud7a3]*(\uae30|\ub07c)", "\uc139[^\uac00-\ud7a3]*\uc2a4", "(\uc2dc|\uc528|\uc26c|\uc4b8)\uc774*\uc785?[^\uac00-\ud7a3]*(\ubc1c|\ube68|\ubc8c|\ubed8|\ud314|\ud384)", "\uc2ed[^\uac00-\ud7a3]*\uc0c8", "\uc539", "(\uc560|\uc5d0)[^\uac00-\ud7a3]*\ubbf8", "\uc790[^\uac00-\ud7a3]*\uc9c0", "\uc874[^\uac00-\ud7a3]*\ub098", "\uc886|\uc8f6", "\uc9c0\ub784", "\ucc3d[^\uac00-\ud7a3]*(\ub140|\ub144|\ub188)", "fuck", "sex"].join('|'), "g");

====================================
[replace] Public 45:46 -> Lib 45:46 (BrokenFix: True)
--- Public ---
var $_sound = {}; // ?�재 ?�생 중인 것들

--- Lib ---
var $_sound = {}; // 현재 재생 중인 것들

====================================
[replace] Public 79:80 -> Lib 79:81 (BrokenFix: False)
--- Public ---
	$data.server = location.href.match(/\?.*server=(\d+)/)[1];

--- Lib ---
	var serverMatch = location.href.match(/[?&]server=(\d+)/);
	$data.server = serverMatch ? serverMatch[1] : null;

====================================
[replace] Public 220:221 -> Lib 221:222 (BrokenFix: False)
--- Public ---
		console.log("Sound packs loaded:", packs);

--- Lib ---
		console.log("Loaded sound packs:", packs);

====================================
[replace] Public 226:231 -> Lib 227:238 (BrokenFix: False)
--- Public ---
		$data.opts = $.cookie('kks');
		if ($data.opts) {
			applyOptions(JSON.parse($data.opts));
		}


--- Lib ---
		var cookieVal = $.cookie('kks');
		try {
			$data.opts = JSON.parse(decodeURIComponent(cookieVal));
		} catch (e) {
			try {
				$data.opts = JSON.parse(cookieVal);
			} catch (e2) {
				$data.opts = {};
			}
		}
		if (!$data.opts) $data.opts = {};

====================================
[delete] Public 232:233
		console.log("Current pack selection:", currentPackName);

====================================
[delete] Public 235:236
		console.log("Current pack files:", packFiles);

====================================
[delete] Public 268:269
		console.log("Final sound list:", $data._soundList);

====================================
[replace] Public 331:332 -> Lib 335:336 (BrokenFix: True)
--- Public ---
	// 객체 ?�정

--- Lib ---
	// 객체 설정

====================================
[replace] Public 348:352 -> Lib 352:353 (BrokenFix: False)
--- Public ---
	$data.opts = $.cookie('kks');
	if ($data.opts) {
		applyOptions(JSON.parse($data.opts));
	}

--- Lib ---


====================================
[replace] Public 719:720 -> Lib 720:721 (BrokenFix: False)
--- Public ---
		$.cookie('kks', JSON.stringify($data.opts));

--- Lib ---
		$.cookie('kks', encodeURIComponent(JSON.stringify($data.opts)));

====================================
[replace] Public 827:828 -> Lib 828:829 (BrokenFix: True)
--- Public ---
		t = t.replace(/[^a-z가-??/g, "");

--- Lib ---
		t = t.replace(/[^a-z가-힣]/g, "");

====================================
[replace] Public 988:989 -> Lib 989:990 (BrokenFix: True)
--- Public ---
	// 리플?�이

--- Lib ---
	// 리플레이

====================================
[replace] Public 1033:1034 -> Lib 1034:1035 (BrokenFix: True)
--- Public ---
	// ?�팸

--- Lib ---
	// 스팸

====================================
[replace] Public 1039:1040 -> Lib 1040:1041 (BrokenFix: True)
--- Public ---
	// ?�소�??�결

--- Lib ---
	// 웹소켓 연결

====================================
[replace] Public 1177:1178 -> Lib 1178:1179 (BrokenFix: False)
--- Public ---
		pushDisplay(data.value, data.mean, data.theme, data.wc, data.bonus);

--- Lib ---
		pushDisplay(data.value, data.mean, data.theme, data.wc);

====================================
[replace] Public 1198:1199 -> Lib 1199:1200 (BrokenFix: False)
--- Public ---
		mobile ? $sc.html("+" + (b.score - b.bonus) + "+" + b.bonus) : addTimeout(function () {

--- Lib ---
		mobile ? $sc.html("+" + (data.score - data.bonus) + "+" + data.bonus) : addTimeout(function () {

====================================
[replace] Public 1421:1422 -> Lib 1422:1423 (BrokenFix: True)
--- Public ---
	$(".cw-q-body").html(processWord("??, data.mean, data.theme, data.type.split(',')));

--- Lib ---
	$(".cw-q-body").html(processWord("★", data.mean, data.theme, data.type.split(',')));

====================================
[replace] Public 1655:1656 -> Lib 1656:1657 (BrokenFix: False)
--- Public ---
		pushDisplay(data.value, data.mean, data.theme, data.wc, data.bonus);

--- Lib ---
		pushDisplay(data.value, data.mean, data.theme, data.wc);

====================================
[replace] Public 1672:1673 -> Lib 1673:1674 (BrokenFix: False)
--- Public ---
		mobile ? $sc.html("+" + (b.score - b.bonus) + "+" + b.bonus) : addTimeout(function () {

--- Lib ---
		mobile ? $sc.html("+" + (data.score - data.bonus) + "+" + data.bonus) : addTimeout(function () {

====================================
[replace] Public 1708:1709 -> Lib 1709:1713 (BrokenFix: False)
--- Public ---
	$stage.game.display.html($data._char = "&lt;" + (L['theme_' + data.theme]) + "&gt;");

--- Lib ---
	var theme = (typeof data.theme == "object")
		? data.theme.map(function (e) { return L['theme_' + e]; }).join("/")
		: L['theme_' + data.theme];
	$stage.game.display.html($data._char = "&lt;" + theme + "&gt;");

====================================
[replace] Public 1764:1765 -> Lib 1768:1769 (BrokenFix: False)
--- Public ---
		pushDisplay(data.value, data.mean, data.theme, data.wc, data.bonus);

--- Lib ---
		pushDisplay(data.value, data.mean, data.theme, data.wc);

====================================
[replace] Public 1781:1782 -> Lib 1785:1902 (BrokenFix: True)
--- Public ---
		mobile ? $sc.html("+" + (b.score - b.bonus) + "+" + b.bonus) : addTimeout(function () {

--- Lib ---
		mobile ? $sc.html("+" + (data.score - data.bonus) + "+" + data.bonus) : addTimeout(function () {
			var $bc = $("<div>")
				.addClass("deltaScore bonus")
				.html("+" + data.bonus);

			drawObtainedScore($uc, $bc);
		}, 500);
	}
	drawObtainedScore($uc, $sc).removeClass("game-user-current");
	updateScore(id, getScore(id));
};

/**
 * Rule the words! KKuTu Online
 * Copyright (C) 2017 JJoriping(op@jjo.kr)
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

$lib.Free = {};
$lib.Free.roundReady = function (data) {
	var i, len = $data.room.game.title.length;

	clearBoard();
	$data._roundTime = $data.room.time * 1000;

	// Display "Free Mode" or similar. 
	// Since there is no specific theme, maybe just "아무거나" (Anything)
	$stage.game.display.html($data._char = "아무거나");

	$stage.game.chain.show().html($data.chain = 0);
	if ($data.room.opts.mission) {
		$stage.game.items.show().css('opacity', 1).html($data.mission = data.mission);
	}
	drawRound(data.round);
	playSound('round_start');
	recordEvent('roundReady', { data: data });
};

$lib.Free.turnStart = function (data) {
	$data.room.game.turn = data.turn;
	if (data.seq) $data.room.game.seq = data.seq;
	if (!($data._tid = $data.room.game.seq[data.turn])) return;
	if ($data._tid.robot) $data._tid = $data._tid.id;
	data.id = $data._tid;

	// Keep the display as is (set in roundReady)
	$stage.game.display.html($data._char);

	$("#game-user-" + data.id).addClass("game-user-current");
	if (!$data._replay) {
		$stage.game.here.css('display', (data.id == $data.id) ? "block" : "none");
		if (data.id == $data.id) {
			if (mobile) $stage.game.hereText.val("").focus();
			else $stage.talk.focus();
		}
	}
	$stage.game.items.html($data.mission = data.mission);

	ws.onmessage = _onMessage;
	clearInterval($data._tTime);
	clearTrespasses();
	// No specific chars to track
	$data._chars = [];
	$data._speed = data.speed;
	$data._tTime = addInterval(turnGoing, TICK);
	$data.turnTime = data.turnTime;
	$data._turnTime = data.turnTime;
	$data._roundTime = data.roundTime;
	$data._turnSound = playSound("T" + data.speed);
	recordEvent('turnStart', {
		data: data
	});
};

$lib.Free.turnGoing = $lib.Classic.turnGoing;
$lib.Free.turnEnd = function (id, data) {
	var $sc = $("<div>")
		.addClass("deltaScore")
		.html((data.score > 0) ? ("+" + (data.score - data.bonus)) : data.score);
	var $uc = $(".game-user-current");
	var hi;

	if ($data._turnSound) $data._turnSound.stop();
	addScore(id, data.score);
	clearInterval($data._tTime);
	if (data.ok) {
		checkFailCombo();
		clearTimeout($data._fail);
		$stage.game.here.hide();
		$stage.game.chain.html(++$data.chain);
		pushDisplay(data.value, data.mean, data.theme, data.wc);
	} else {
		checkFailCombo(id);
		$sc.addClass("lost");
		$(".game-user-current").addClass("game-user-bomb");
		$stage.game.here.hide();
		playSound('timeout');
	}
	if (data.hint) {
		// Just display the hint word without special highlighting
		$stage.game.display.empty()
			.append($("<label>").html(data.hint));
	}
	if (data.bonus) {
		mobile ? $sc.html("+" + (data.score - data.bonus) + "+" + data.bonus) : addTimeout(function () {

====================================
[replace] Public 1841:1842 -> Lib 1961:1962 (BrokenFix: True)
--- Public ---
			$data._board = $data._board.replace(key.charAt(i), "?�");

--- Lib ---
			$data._board = $data._board.replace(key.charAt(i), "　");

====================================
[replace] Public 1872:1873 -> Lib 1992:1993 (BrokenFix: True)
--- Public ---
			// if(text.charAt(i) != "�?) $c.css('color', "#EEEEEE");

--- Lib ---
			// if(text.charAt(i) != "？") $c.css('color', "#EEEEEE");

====================================
[replace] Public 1880:1881 -> Lib 2000:2005 (BrokenFix: False)
--- Public ---
	var size = "calc((100% - 1px) / " + Math.sqrt(va.length) + ")";

--- Lib ---
	var len = Math.sqrt($data._board.length);
	var size = (100 / len) + "%";
	var fontSize = (len > 10) ? "15px" : "";

	$a.css({ 'display': 'flex', 'flex-wrap': 'wrap', 'align-content': 'flex-start' });

====================================
[replace] Public 1883:1884 -> Lib 2007:2008 (BrokenFix: False)
--- Public ---
		$a.append($c = $("<div>").addClass("sock-char sock-" + item).css({ width: size, height: size, float: 'left', margin: 0, padding: 0, boxSizing: 'border-box' }).html(item));

--- Lib ---
		$a.append($c = $("<div>").addClass("sock-char sock-" + item).css({ width: size, height: size, 'font-size': fontSize }).html(item));

====================================
[replace] Public 2021:2022 -> Lib 2145:2146 (BrokenFix: True)
--- Public ---
	return; // ?�단 비활?�화

--- Lib ---
	return; // 일단 비활성화

====================================
[replace] Public 2121:2123 -> Lib 2245:2247 (BrokenFix: True)
--- Public ---
			$introText.html('게스?�는 캡챠 ?�증???�요?�니??' +
				'<br/>로그?�을 ?�시�?캡챠 ?�증??건너?�실 ???�습?�다.' +

--- Lib ---
			$introText.html('게스트는 캡챠 인증이 필요합니다.' +
				'<br/>로그인을 하시면 캡챠 인증을 건너뛰실 수 있습니다.' +

====================================
[replace] Public 2363:2364 -> Lib 2487:2489 (BrokenFix: True)
--- Public ---
				/* 로그??				$.cookie('preprev', location.href);

--- Lib ---
				/* 로그인
				$.cookie('preprev', location.href);

====================================
[replace] Public 2375:2380 -> Lib 2500:2550 (BrokenFix: True)
--- Public ---
				// 게임 �?				if (confirm(L['error_' + data.code])) {
				stopBGM();
				$data._spectate = true;
				$data._gaming = true;
				send('enter', { id: data.target, password: $data._pw, spectate: true }, true);

--- Lib ---
				// 게임 중
				if (confirm(L['error_' + data.code])) {
					stopBGM();
					$data._spectate = true;
					$data._gaming = true;
					send('enter', { id: data.target, password: $data._pw, spectate: true }, true);
				}
				return;
			} else if (data.code == 413) {
				$stage.dialog.room.hide();
				$stage.menu.setRoom.trigger('click');
			} else if (data.code == 429) {
				playBGM('lobby');
			} else if (data.code == 430) {
				$data.setRoom(data.message, null);
				if ($stage.dialog.quick.is(':visible')) {
					$data._preQuick = false;
					break;
				}
			} else if (data.code == 431 || data.code == 432 || data.code == 433) {
				$stage.dialog.room.show();
			} else if (data.code == 444) {
				i = data.message;
				if (i.indexOf("생년월일") != -1) {
					alert("생년월일이 올바르게 입력되지 않아 게임 이용이 제한되었습니다. 잠시 후 다시 시도해 주세요.");
					break;
				}
				/* Enhanced User Block System [S] */
				if (!data.blockedUntil) break;

				var blockedUntil = new Date(parseInt(data.blockedUntil));
				var block = "\n제한 시점: " + blockedUntil.getFullYear() + "년 " + blockedUntil.getMonth() + 1 + "월 " +
					blockedUntil.getDate() + "일 " + blockedUntil.getHours() + "시 " + blockedUntil.getMinutes() + "분까지";

				alert("[#444] " + L['error_444'] + i + block);
				break;
			} else if (data.code == 446) {
				i = data.reasonBlocked;
				if (!data.ipBlockedUntil) break;

				var blockedUntil = new Date(parseInt(data.ipBlockedUntil));
				var block = "\n제한 시점: " + blockedUntil.getFullYear() + "년 " + blockedUntil.getMonth() + 1 + "월 " +
					blockedUntil.getDate() + "일 " + blockedUntil.getHours() + "시 " + blockedUntil.getMinutes() + "분까지";

				alert("[#446] " + L['error_446'] + i + block);
				break;
				/* Enhanced User Block System [E] */
			} else if (data.code === 447) {
				alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");
				break;

====================================
[replace] Public 2381:2391 -> Lib 2551:2552 (BrokenFix: False)
--- Public ---
			return;
	} else if (data.code == 413) {
		$stage.dialog.room.hide();
		$stage.menu.setRoom.trigger('click');
	} else if (data.code == 429) {
		playBGM('lobby');
	} else if (data.code == 430) {
		$data.setRoom(data.message, null);
		if ($stage.dialog.quick.is(':visible')) {
			$data._preQuick = false;

--- Lib ---
			alert("[#" + data.code + "] " + L['error_' + data.code] + i);

====================================
[replace] Public 2392:2399 -> Lib 2553:2554 (BrokenFix: False)
--- Public ---
		}
	} else if (data.code == 431 || data.code == 432 || data.code == 433) {
		$stage.dialog.room.show();
	} else if (data.code == 444) {
		i = data.message;
		if (i.indexOf("?�년?�일") != -1) {
			alert("?�년?�일???�바르게 ?�력?��? ?�아 게임 ?�용???�한?�었?�니?? ?�시 ???�시 ?�도??주세??");

--- Lib ---
		default:

====================================
[replace] Public 2400:2435 -> Lib 2555:2561 (BrokenFix: False)
--- Public ---
		}
		/* Enhanced User Block System [S] */
		if (!data.blockedUntil) break;

		var blockedUntil = new Date(parseInt(data.blockedUntil));
		var block = "\n?�한 ?�점: " + blockedUntil.getFullYear() + "??" + blockedUntil.getMonth() + 1 + "??" +
			blockedUntil.getDate() + "??" + blockedUntil.getHours() + "??" + blockedUntil.getMinutes() + "분까지";

		alert("[#444] " + L['error_444'] + i + block);
		break;
	} else if (data.code == 446) {
		i = data.reasonBlocked;
		if (!data.ipBlockedUntil) break;

		var blockedUntil = new Date(parseInt(data.ipBlockedUntil));
		var block = "\n?�한 ?�점: " + blockedUntil.getFullYear() + "??" + blockedUntil.getMonth() + 1 + "??" +
			blockedUntil.getDate() + "??" + blockedUntil.getHours() + "??" + blockedUntil.getMinutes() + "분까지";

		alert("[#446] " + L['error_446'] + i + block);
		break;
		/* Enhanced User Block System [E] */
	} else if (data.code === 447) {
		alert("?�동??�?방�?�??�한 캡챠 ?�증???�패?�습?�다. 메인 ?�면?�서 ?�시 ?�도??주세??");
		break;
	}
	alert("[#" + data.code + "] " + L['error_' + data.code] + i);
	break;
		default:
	break;
}
if ($data._record) recordEvent(data);

function recaptchaCallback(response) {
	ws.send(JSON.stringify({ type: 'recaptcha', token: response }));
}

--- Lib ---
	}
	if ($data._record) recordEvent(data);

	function recaptchaCallback(response) {
		ws.send(JSON.stringify({ type: 'recaptcha', token: response }));
	}

====================================
[replace] Public 2457:2462 -> Lib 2583:2588 (BrokenFix: True)
--- Public ---
		'/??: L['cmd_r'],
		'/�?��': L['cmd_cls'],
		'/??: L['cmd_f'],
		'/??: L['cmd_e'],
		'/?�ㄷ': L['cmd_ee'],

--- Lib ---
		'/ㄱ': L['cmd_r'],
		'/청소': L['cmd_cls'],
		'/ㄹ': L['cmd_f'],
		'/ㄷ': L['cmd_e'],
		'/ㄷㄷ': L['cmd_ee'],

====================================
[replace] Public 2468:2469 -> Lib 2594:2595 (BrokenFix: True)
--- Public ---
		case "/??:

--- Lib ---
		case "/ㄱ":

====================================
[replace] Public 2475:2476 -> Lib 2601:2602 (BrokenFix: True)
--- Public ---
		case "/�?��":

--- Lib ---
		case "/청소":

====================================
[replace] Public 2479:2480 -> Lib 2605:2606 (BrokenFix: True)
--- Public ---
		case "/??:

--- Lib ---
		case "/ㄹ":

====================================
[replace] Public 2484:2486 -> Lib 2610:2612 (BrokenFix: True)
--- Public ---
		case "/�?:
		case "/??:

--- Lib ---
		case "/귓":
		case "/ㄷ":

====================================
[replace] Public 2489:2491 -> Lib 2615:2617 (BrokenFix: True)
--- Public ---
		case "/??:
		case "/?�ㄷ":

--- Lib ---
		case "/답":
		case "/ㄷㄷ":

====================================
[replace] Public 2529:2537 -> Lib 2655:2719 (BrokenFix: True)
--- Public ---
		chat({
			title: "?? + target }, text, true);
		}
}
	function toggleWhisperBlock(target) {
		if ($data._wblock.hasOwnProperty(target)) {
			delete $data._wblock[target];
			notice(target + L['wnblocked']);

--- Lib ---
		chat({ title: "→" + target }, text, true);
	}
}
function toggleWhisperBlock(target) {
	if ($data._wblock.hasOwnProperty(target)) {
		delete $data._wblock[target];
		notice(target + L['wnblocked']);
	} else {
		$data._wblock[target] = true;
		notice(target + L['wblocked']);
	}
}
function toggleShutBlock(target) {
	if ($data._shut.hasOwnProperty(target)) {
		delete $data._shut[target];
		notice(target + L['userNShut']);
	} else {
		$data._shut[target] = true;
		notice(target + L['userShut']);
	}
}
function tryDict(text, callback) {
	var text = text.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g, "");
	var lang = text.match(/[ㄱ-ㅎ가-힣]/) ? 'ko' : 'en';

	if (text.length < 1) return callback({ error: 404 });
	$.get("/dict/" + text + "?lang=" + lang, callback);
}
function processRoom(data) {
	var i, j, key, o;

	data.myRoom = ($data.place == data.room.id) || (data.target == $data.id);
	if (data.myRoom) {
		$target = $data.users[data.target];
		if (data.kickVote) {
			notice(getKickText($target.profile, data.kickVote));
			if ($target.id == data.id) alert(L['hasKicked']);
		}
		if (data.room.players.indexOf($data.id) == -1) {
			if ($data.room) if ($data.room.gaming) {
				stopAllSounds();
				$data.practicing = false;
				$data._gaming = false;
				$stage.box.room.height(360);
				playBGM('lobby');
			}
			$data.users[$data.id].game.ready = false;
			$data.users[$data.id].game.team = 0;
			$data.users[$data.id].game.form = "J";
			$stage.menu.spectate.removeClass("toggled");
			$stage.menu.ready.removeClass("toggled");
			$data.room = null;
			$data.resulting = false;
			$data._players = null;
			$data._master = null;
			$data.place = 0;
			if (data.room.practice) {
				delete $data.users[0];
				$data.room = $data._room;
				$data.place = $data._place;
				$data.master = $data.__master;
				$data._players = $data.__players;
				delete $data._room;
			}

====================================
[replace] Public 2538:2567 -> Lib 2720:2726 (BrokenFix: False)
--- Public ---
			$data._wblock[target] = true;
			notice(target + L['wblocked']);
		}
	}
	function toggleShutBlock(target) {
		if ($data._shut.hasOwnProperty(target)) {
			delete $data._shut[target];
			notice(target + L['userNShut']);
		} else {
			$data._shut[target] = true;
			notice(target + L['userShut']);
		}
	}
	function tryDict(text, callback) {
		var text = text.replace(/[^\sa-zA-Z????-9가-??/g, "");
		var lang = text.match(/[???��?-??/) ? 'ko' : 'en';

		if (text.length < 1) return callback({ error: 404 });
		$.get("/dict/" + text + "?lang=" + lang, callback);
	}
	function processRoom(data) {
		var i, j, key, o;

		data.myRoom = ($data.place == data.room.id) || (data.target == $data.id);
		if (data.myRoom) {
			$target = $data.users[data.target];
			if (data.kickVote) {
				notice(getKickText($target.profile, data.kickVote));
				if ($target.id == data.id) alert(L['hasKicked']);

--- Lib ---
			if (data.room.practice && !$data.practicing) {
				$data.practicing = true;
				$data._room = $data.room;
				$data._place = $data.place;
				$data.__master = $data.master;
				$data.__players = $data._players;

====================================
[replace] Public 2568:2575 -> Lib 2727:2744 (BrokenFix: False)
--- Public ---
			if (data.room.players.indexOf($data.id) == -1) {
				if ($data.room) if ($data.room.gaming) {
					stopAllSounds();
					$data.practicing = false;
					$data._gaming = false;
					$stage.box.room.height(360);
					playBGM('lobby');

--- Lib ---
			if ($data.room) {
				$data._players = $data.room.players.toString();
				$data._master = $data.room.master;
				$data._rTitle = $data.room.title;
				$data._rMode = getOptions($data.room.mode, $data.room.opts, true);
				$data._rLimit = $data.room.limit;
				$data._rRound = $data.room.round;
				$data._rTime = $data.room.time;
			}
			$data.room = data.room;
			$data.place = $data.room.id;
			$data.master = $data.room.master == $data.id;
			if (data.spec && data.target == $data.id) {
				if (!$data._spectate) {
					$data._spectate = true;
					clearBoard();
					drawRound();

====================================
[replace] Public 2576:2631 -> Lib 2745:2755 (BrokenFix: True)
--- Public ---
				$data.users[$data.id].game.ready = false;
				$data.users[$data.id].game.team = 0;
				$data.users[$data.id].game.form = "J";
				$stage.menu.spectate.removeClass("toggled");
				$stage.menu.ready.removeClass("toggled");
				$data.room = null;
				$data.resulting = false;
				$data._players = null;
				$data._master = null;
				$data.place = 0;
				if (data.room.practice) {
					delete $data.users[0];
					$data.room = $data._room;
					$data.place = $data._place;
					$data.master = $data.__master;
					$data._players = $data.__players;
					delete $data._room;
				}
			} else {
				if (data.room.practice && !$data.practicing) {
					$data.practicing = true;
					$data._room = $data.room;
					$data._place = $data.place;
					$data.__master = $data.master;
					$data.__players = $data._players;
				}
				if ($data.room) {
					$data._players = $data.room.players.toString();
					$data._master = $data.room.master;
					$data._rTitle = $data.room.title;
					$data._rMode = getOptions($data.room.mode, $data.room.opts, true);
					$data._rLimit = $data.room.limit;
					$data._rRound = $data.room.round;
					$data._rTime = $data.room.time;
				}
				$data.room = data.room;
				$data.place = $data.room.id;
				$data.master = $data.room.master == $data.id;
				if (data.spec && data.target == $data.id) {
					if (!$data._spectate) {
						$data._spectate = true;
						clearBoard();
						drawRound();
					}
					if (data.boards) {
						// ??��말�???처리
						$data.selectedRound = 1;
						for (i in data.prisoners) {
							key = i.split(',');
							for (j in data.boards[key[0]]) {
								o = data.boards[key[0]][j];
								if (o[0] == key[1] && o[1] == key[2] && o[2] == key[3]) {
									o[4] = data.prisoners[i];
									break;
								}

--- Lib ---
				if (data.boards) {
					// 십자말풀이 처리
					$data.selectedRound = 1;
					for (i in data.prisoners) {
						key = i.split(',');
						for (j in data.boards[key[0]]) {
							o = data.boards[key[0]][j];
							if (o[0] == key[1] && o[1] == key[2] && o[2] == key[3]) {
								o[4] = data.prisoners[i];
								break;

====================================
[delete] Public 2633:2635
						$lib.Crossword.roundReady(data, true);
						$lib.Crossword.turnStart(data, true);

====================================
[replace] Public 2636:2639 -> Lib 2758:2763 (BrokenFix: False)
--- Public ---
					for (i in data.spec) {
						$data.users[i].game.score = data.spec[i];
					}

--- Lib ---
					$lib.Crossword.roundReady(data, true);
					$lib.Crossword.turnStart(data, true);
				}
				for (i in data.spec) {
					$data.users[i].game.score = data.spec[i];

====================================
[replace] Public 2641:2650 -> Lib 2765:2774 (BrokenFix: False)
--- Public ---
			if (!data.modify && data.target == $data.id) forkChat();
		}
		if (data.target) {
			if ($data.users[data.target]) {
				if (data.room.players.indexOf(data.target) == -1) {
					$data.users[data.target].place = 0;
				} else {
					$data.users[data.target].place = data.room.id;
				}

--- Lib ---
		}
		if (!data.modify && data.target == $data.id) forkChat();
	}
	if (data.target) {
		if ($data.users[data.target]) {
			if (data.room.players.indexOf(data.target) == -1) {
				$data.users[data.target].place = 0;
			} else {
				$data.users[data.target].place = data.room.id;

====================================
[replace] Public 2652:2662 -> Lib 2776:2784 (BrokenFix: False)
--- Public ---
		if (!data.room.practice) {
			if (data.room.players.length) {
				$data.setRoom(data.room.id, data.room);
				for (i in data.room.readies) {
					if (!$data.users[i]) continue;
					$data.users[i].game.ready = data.room.readies[i].r;
					$data.users[i].game.team = data.room.readies[i].t;
				}
			} else {
				$data.setRoom(data.room.id, null);

--- Lib ---
	}
	if (!data.room.practice) {
		if (data.room.players.length) {
			$data.setRoom(data.room.id, data.room);
			for (i in data.room.readies) {
				if (!$data.users[i]) continue;
				$data.users[i].game.ready = data.room.readies[i].r;
				$data.users[i].game.team = data.room.readies[i].t;

====================================
[delete] Public 2663:2839
		}
	}
	function getOnly() {
		return $data.place ? (($data.room.gaming || $data.resulting) ? "for-gaming" : ($data.master ? "for-master" : "for-normal")) : "for-lobby";
	}
	function updateUI(myRoom, refresh) {
		/*
			myRoom??undefined??경우: ?�점/결과 ?�인
			myRoom??true/false??경우: �???	*/
		var only = getOnly();
		var i;

		if ($data._replay) {
			if (myRoom === undefined || myRoom) {
				replayStop();
			} else return;
		}
		if ($data._replay) return;
		if (only == "for-gaming" && !myRoom) return;
		if ($data.practicing) only = "for-gaming";

		$(".kkutu-menu button").hide();
		for (i in $stage.box) $stage.box[i].hide();
		$stage.box.me.show();
		$stage.box.chat.show().width(790).height(190);
		$stage.chat.height(120);

		if (only == "for-lobby") {
			$data._ar_first = true;
			$stage.box.userList.show();
			if ($data._shop) {
				$stage.box.roomList.hide();
				$stage.box.shop.show();
			} else {
				$stage.box.roomList.show();
				$stage.box.shop.hide();
			}
			updateUserList(refresh || only != $data._only);
			updateRoomList(refresh || only != $data._only);
			updateMe();
			if ($data._jamsu) {
				clearTimeout($data._jamsu);
				delete $data._jamsu;
			}
		} else if (only == "for-master" || only == "for-normal") {
			$(".team-chosen").removeClass("team-chosen");
			if ($data.users[$data.id].game.ready || $data.users[$data.id].game.form == "S") {
				$stage.menu.ready.addClass("toggled");
				$(".team-selector").addClass("team-unable");
			} else {
				$stage.menu.ready.removeClass("toggled");
				$(".team-selector").removeClass("team-unable");
				$("#team-" + $data.users[$data.id].game.team).addClass("team-chosen");
				if ($data.opts.ar && $data._ar_first) {
					$stage.menu.ready.addClass("toggled");
					$stage.menu.ready.trigger('click');
					$data._ar_first = false;
				}
			}
			$data._shop = false;
			$stage.box.room.show().height(360);
			if (only == "for-master") if ($stage.dialog.inviteList.is(':visible')) updateUserList();
			updateRoom(false);
			updateMe();
		} else if (only == "for-gaming") {
			if ($data._gAnim) {
				$stage.box.room.show();
				$data._gAnim = false;
			}
			$data._shop = false;
			$data._ar_first = true;
			$stage.box.me.hide();
			$stage.box.game.show();
			$(".ChatBox").width(1000).height(140);
			$stage.chat.height(70);
			updateRoom(true);
		}
		$data._only = only;
		setLocation($data.place);
		$(".kkutu-menu ." + only).show();
	}
	function animModified(cls) {
		$(cls).addClass("room-head-modified");
		addTimeout(function () { $(cls).removeClass("room-head-modified"); }, 3000);
	}
	function checkRoom(modify) {
		if (!$data._players) return;
		if (!$data.room) return;

		var OBJ = {} + '';
		var i, arr = $data._players.split(',');
		var lb = arr.length, la = $data.room.players.length;
		var u;

		for (i in arr) {
			if (arr[i] == OBJ) lb--;
		}
		for (i in $data.room.players) {
			if ($data.room.players[i].robot) la--;
		}
		if (modify) {
			for (i in arr) {
				if (arr[i] != OBJ) $data.users[arr[i]].game.ready = false;
			}
			notice(L['hasModified']);
		}
		if ($data._gaming != $data.room.gaming) {
			if ($data.room.gaming) {
				gameReady();
				$data._replay = false;
				startRecord($data.room.game.title);
			} else {
				if ($data._spectate) {
					$stage.dialog.resultSave.hide();
					$data._spectate = false;
					playBGM('lobby');
				} else {
					$stage.dialog.resultSave.show();
					$data.resulting = true;
				}
				clearInterval($data._tTime);
			}
		}
		if ($data._master != $data.room.master) {
			u = $data.users[$data.room.master];
			notice((u.profile.title || u.profile.name) + L['hasMaster']);
		}
		$data._players = $data.room.players.toString();
		$data._master = $data.room.master;
		$data._gaming = $data.room.gaming;
	}
	function updateMe() {
		var my = $data.users[$data.id];
		var i, gw = 0;
		var lv = getLevel(my.data.score);
		var prev = EXP[lv - 2] || 0;
		var goal = EXP[lv - 1];

		for (i in my.data.record) gw += my.data.record[i][1];
		renderMoremi(".my-image", my.equip);
		// $(".my-image").css('background-image', "url('"+my.profile.image+"')");
		$(".my-stat-level").replaceWith(getLevelImage(my.data.score).addClass("my-stat-level"));
		$(".my-stat-name").html(my.profile.title || my.profile.name);
		$(".my-stat-record").html(L['globalWin'] + " " + gw + L['W']);
		$(".my-stat-ping").html(commify(my.money) + L['ping']);
		$(".my-okg .graph-bar").width(($data._playTime % 600000) / 6000 + "%");
		$(".my-okg-text").html(prettyTime($data._playTime));
		$(".my-level").html(L['LEVEL'] + " " + lv);
		$(".my-gauge .graph-bar").width((my.data.score - prev) / (goal - prev) * 190);
		$(".my-gauge-text").html(commify(my.data.score) + " / " + commify(goal));
	}
	function prettyTime(time) {
		var min = Math.floor(time / 60000) % 60, sec = Math.floor(time * 0.001) % 60;
		var hour = Math.floor(time / 3600000);
		var txt = [];

		if (hour) txt.push(hour + L['HOURS']);
		if (min) txt.push(min + L['MINUTE']);
		if (!hour) txt.push(sec + L['SECOND']);
		return txt.join(' ');
	}
	function updateUserList(refresh) {
		var $bar;
		var i, o, len = 0;
		var arr;

		// refresh = true;
		// if(!$stage.box.userList.is(':visible')) return;
		if ($data.opts.su) {
			arr = [];
			for (i in $data.users) {
				len++;
				arr.push($data.users[i]);
			}
			arr.sort(function (a, b) { return b.data.score - a.data.score; });
			refresh = true;

====================================
[replace] Public 2840:2873 -> Lib 2786:2822 (BrokenFix: True)
--- Public ---
			arr = $data.users;

			for (i in $data.users) len++;
		}
		$stage.lobby.userListTitle.html("<i class='fa fa-users'></i>"
			+ "&lt;<b>" + L['server_' + $data.server] + "</b>&gt; "
			+ L['UserList'].replace("FA{users}", "")
			+ " [" + len + L['MN'] + "]");

		if (refresh) {
			$stage.lobby.userList.empty();
			$stage.dialog.inviteList.empty();
			for (i in arr) {
				o = arr[i];
				if (o.robot) continue;

				$stage.lobby.userList.append(userListBar(o));
				if (o.place == 0) $stage.dialog.inviteList.append(userListBar(o, true));
			}
		}
	}
	function userListBar(o, forInvite) {
		var $R;

		if (forInvite) {
			$R = $("<div>").attr('id', "invite-item-" + o.id).addClass("invite-item users-item")
				.append($("<div>").addClass("jt-image users-image").css('background-image', "url('" + o.profile.image + "')"))
				.append(getLevelImage(o.data.score).addClass("users-level"))
				// .append($("<div>").addClass("jt-image users-from").css('background-image', "url('/img/kkutu/"+o.profile.type+".png')"))
				.append($("<div>").addClass("users-name").html(o.profile.title || o.profile.name))
				.on('click', function (e) {
					requestInvite($(e.currentTarget).attr('id').slice(12));
				});

--- Lib ---
			$data.setRoom(data.room.id, null);
		}
	}
}
function getOnly() {
	return $data.place ? (($data.room.gaming || $data.resulting) ? "for-gaming" : ($data.master ? "for-master" : "for-normal")) : "for-lobby";
}
function updateUI(myRoom, refresh) {
	/*
		myRoom이 undefined인 경우: 상점/결과 확인
		myRoom이 true/false인 경우: 그 외
	*/
	var only = getOnly();
	var i;

	if ($data._replay) {
		if (myRoom === undefined || myRoom) {
			replayStop();
		} else return;
	}
	if ($data._replay) return;
	if (only == "for-gaming" && !myRoom) return;
	if ($data.practicing) only = "for-gaming";

	$(".kkutu-menu button").hide();
	for (i in $stage.box) $stage.box[i].hide();
	$stage.box.me.show();
	$stage.box.chat.show().width(790).height(190);
	$stage.chat.height(120);

	if (only == "for-lobby") {
		$data._ar_first = true;
		$stage.box.userList.show();
		if ($data._shop) {
			$stage.box.roomList.hide();
			$stage.box.shop.show();

====================================
[replace] Public 2874:3006 -> Lib 2823:2830 (BrokenFix: False)
--- Public ---
			$R = $("<div>").attr('id', "users-item-" + o.id).addClass("users-item")
				.append($("<div>").addClass("jt-image users-image").css('background-image', "url('" + o.profile.image + "')"))
				.append(getLevelImage(o.data.score).addClass("users-level"))
				// .append($("<div>").addClass("jt-image users-from").css('background-image', "url('/img/kkutu/"+o.profile.type+".png')"))
				.append($("<div>").addClass("users-name ellipse").html(o.profile.title || o.profile.name))
				.on('click', function (e) {
					requestProfile($(e.currentTarget).attr('id').slice(11));
				});
		}
		addonNickname($R, o);

		return $R;
	}
	function addonNickname($R, o) {
		if (o.equip['NIK']) $R.addClass("x-" + o.equip['NIK']);
		if (o.equip['BDG'] == "b1_gm") $R.addClass("x-gm");
	}
	function updateRoomList(refresh) {
		var i;
		var len = 0;

		if (!refresh) {
			$(".rooms-create").remove();
			for (i in $data.rooms) len++;
		} else {
			$stage.lobby.roomList.empty();
			for (i in $data.rooms) {
				$stage.lobby.roomList.append(roomListBar($data.rooms[i]));
				len++;
			}
		}
		$stage.lobby.roomListTitle.html(L['RoomList'].replace("FA{bars}", "<i class='fa fa-bars'></i>") + " [" + len + L['GAE'] + "]");

		if (len) {
			$(".rooms-gaming").css('display', $data.opts.ow ? "none" : "");
			$(".rooms-locked").css('display', $data.opts.ou ? "none" : "");
		} else {
			$stage.lobby.roomList.append($stage.lobby.createBanner.clone().on('click', onBanner));
		}
		function onBanner(e) {
			$stage.menu.newRoom.trigger('click');
		}
	}
	function roomListBar(o) {
		var $R, $ch;
		var opts = getOptions(o.mode, o.opts);

		$R = $("<div>").attr('id', "room-" + o.id).addClass("rooms-item")
			.append($ch = $("<div>").addClass("rooms-channel channel-" + o.channel).on('click', function (e) { requestRoomInfo(o.id); }))
			.append($("<div>").addClass("rooms-number").html(o.id))
			.append($("<div>").addClass("rooms-title ellipse").text(badWords(o.title)))
			.append($("<div>").addClass("rooms-limit").html(o.players.length + " / " + o.limit))
			.append($("<div>").width(270)
				.append($("<div>").addClass("rooms-mode").html(opts.join(" / ").toString()))
				.append($("<div>").addClass("rooms-round").html(L['rounds'] + " " + o.round))
				.append($("<div>").addClass("rooms-time").html(o.time + L['SECOND']))
			)
			.append($("<div>").addClass("rooms-lock").html(o.password ? "<i class='fa fa-lock'></i>" : "<i class='fa fa-unlock'></i>"))
			.on('click', function (e) {
				if (e.target == $ch.get(0)) return;
				tryJoin($(e.currentTarget).attr('id').slice(5));
			});
		if (o.gaming) $R.addClass("rooms-gaming");
		if (o.password) $R.addClass("rooms-locked");

		return $R;
	}
	function normalGameUserBar(o) {
		var $m, $n, $bar;
		var $R = $("<div>").attr('id', "game-user-" + o.id).addClass("game-user")
			.append($m = $("<div>").addClass("moremi game-user-image"))
			.append($("<div>").addClass("game-user-title")
				.append(getLevelImage(o.data.score).addClass("game-user-level"))
				.append($bar = $("<div>").addClass("game-user-name ellipse").html(o.profile.title || o.profile.name))
				.append($("<div>").addClass("expl").html(L['LEVEL'] + " " + getLevel(o.data.score)))
			)
			.append($n = $("<div>").addClass("game-user-score"));
		renderMoremi($m, o.equip);
		global.expl($R);
		addonNickname($bar, o);
		if (o.game.team) $n.addClass("team-" + o.game.team);

		return $R;
	}
	function miniGameUserBar(o) {
		var $n, $bar;
		var $R = $("<div>").attr('id', "game-user-" + o.id).addClass("game-user")
			.append($("<div>").addClass("game-user-title")
				.append(getLevelImage(o.data.score).addClass("game-user-level"))
				.append($bar = $("<div>").addClass("game-user-name ellipse").html(o.profile.title || o.profile.name))
			)
			.append($n = $("<div>").addClass("game-user-score"));
		if (o.id == $data.id) $bar.addClass("game-user-my-name");
		addonNickname($bar, o);
		if (o.game.team) $n.addClass("team-" + o.game.team);

		return $R;
	}
	function getAIProfile(level) {
		return {
			title: L['aiLevel' + level] + ' ' + L['robot'],
			image: "/img/kkutu/robot.png"
		};
	}
	function updateRoom(gaming) {
		var i, o, $r;
		var $y, $z;
		var $m;
		var $bar;
		var rule = RULE[MODE[$data.room.mode]];
		var renderer = (mobile || rule.big) ? miniGameUserBar : normalGameUserBar;
		var spec;
		var arAcc = false, allReady = true;

		setRoomHead($(".RoomBox .product-title"), $data.room);
		setRoomHead($(".GameBox .product-title"), $data.room);
		if (gaming) {
			$r = $(".GameBox .game-body").empty();
			// updateScore(true);
			for (i in $data.room.game.seq) {
				if ($data._replay) {
					o = $rec.users[$data.room.game.seq[i]] || $data.room.game.seq[i];
				} else {
					o = $data.users[$data.room.game.seq[i]] || $data.robots[$data.room.game.seq[i].id] || $data.room.game.seq[i];
				}
				if (o.robot && !o.profile) {
					o.profile = getAIProfile(o.level);
					$data.robots[o.id] = o;
				}
				$r.append(renderer(o));
				updateScore(o.id, o.game.score || 0);
			}

--- Lib ---
			$stage.box.roomList.show();
			$stage.box.shop.hide();
		}
		updateUserList(refresh || only != $data._only);
		updateRoomList(refresh || only != $data._only);
		updateMe();
		if ($data._jamsu) {

====================================
[insert] Lib 2832:2838
		}
	} else if (only == "for-master" || only == "for-normal") {
		$(".team-chosen").removeClass("team-chosen");
		if ($data.users[$data.id].game.ready || $data.users[$data.id].game.form == "S") {
			$stage.menu.ready.addClass("toggled");
			$(".team-selector").addClass("team-unable");

====================================
[replace] Public 3009:3012 -> Lib 2839:3139 (BrokenFix: True)
--- Public ---
			$r = $(".room-users").empty();
			spec = $data.users[$data.id].game.form == "S";
			// 참�???		for (i in $data.room.players) {

--- Lib ---
			$stage.menu.ready.removeClass("toggled");
			$(".team-selector").removeClass("team-unable");
			$("#team-" + $data.users[$data.id].game.team).addClass("team-chosen");
			if ($data.opts.ar && $data._ar_first) {
				$stage.menu.ready.addClass("toggled");
				$stage.menu.ready.trigger('click');
				$data._ar_first = false;
			}
		}
		$data._shop = false;
		$stage.box.room.show().height(360);
		if (only == "for-master") if ($stage.dialog.inviteList.is(':visible')) updateUserList();
		updateRoom(false);
		updateMe();
	} else if (only == "for-gaming") {
		if ($data._gAnim) {
			$stage.box.room.show();
			$data._gAnim = false;
		}
		$data._shop = false;
		$data._ar_first = true;
		$stage.box.me.hide();
		$stage.box.game.show();
		$(".ChatBox").width(1000).height(140);
		$stage.chat.height(70);
		updateRoom(true);
	}
	$data._only = only;
	setLocation($data.place);
	$(".kkutu-menu ." + only).show();
}
function animModified(cls) {
	$(cls).addClass("room-head-modified");
	addTimeout(function () { $(cls).removeClass("room-head-modified"); }, 3000);
}
function checkRoom(modify) {
	if (!$data._players) return;
	if (!$data.room) return;

	var OBJ = {} + '';
	var i, arr = $data._players.split(',');
	var lb = arr.length, la = $data.room.players.length;
	var u;

	for (i in arr) {
		if (arr[i] == OBJ) lb--;
	}
	for (i in $data.room.players) {
		if ($data.room.players[i].robot) la--;
	}
	if (modify) {
		for (i in arr) {
			if (arr[i] != OBJ) $data.users[arr[i]].game.ready = false;
		}
		notice(L['hasModified']);
	}
	if ($data._gaming != $data.room.gaming) {
		if ($data.room.gaming) {
			gameReady();
			$data._replay = false;
			startRecord($data.room.game.title);
		} else {
			if ($data._spectate) {
				$stage.dialog.resultSave.hide();
				$data._spectate = false;
				playBGM('lobby');
			} else {
				$stage.dialog.resultSave.show();
				$data.resulting = true;
			}
			clearInterval($data._tTime);
		}
	}
	if ($data._master != $data.room.master) {
		u = $data.users[$data.room.master];
		notice((u.profile.title || u.profile.name) + L['hasMaster']);
	}
	$data._players = $data.room.players.toString();
	$data._master = $data.room.master;
	$data._gaming = $data.room.gaming;
}
function updateMe() {
	var my = $data.users[$data.id];
	var i, gw = 0;
	var lv = getLevel(my.data.score);
	var prev = EXP[lv - 2] || 0;
	var goal = EXP[lv - 1];

	for (i in my.data.record) gw += my.data.record[i][1];
	renderMoremi(".my-image", my.equip);
	// $(".my-image").css('background-image', "url('"+my.profile.image+"')");
	$(".my-stat-level").replaceWith(getLevelImage(my.data.score).addClass("my-stat-level"));
	$(".my-stat-name").html(my.profile.title || my.profile.name);
	$(".my-stat-record").html(L['globalWin'] + " " + gw + L['W']);
	$(".my-stat-ping").html(commify(my.money) + L['ping']);
	$(".my-okg .graph-bar").width(($data._playTime % 600000) / 6000 + "%");
	$(".my-okg-text").html(prettyTime($data._playTime));
	$(".my-level").html(L['LEVEL'] + " " + lv);
	$(".my-gauge .graph-bar").width((my.data.score - prev) / (goal - prev) * 190);
	$(".my-gauge-text").html(commify(my.data.score) + " / " + commify(goal));
}
function prettyTime(time) {
	var min = Math.floor(time / 60000) % 60, sec = Math.floor(time * 0.001) % 60;
	var hour = Math.floor(time / 3600000);
	var txt = [];

	if (hour) txt.push(hour + L['HOURS']);
	if (min) txt.push(min + L['MINUTE']);
	if (!hour) txt.push(sec + L['SECOND']);
	return txt.join(' ');
}
function updateUserList(refresh) {
	var $bar;
	var i, o, len = 0;
	var arr;

	// refresh = true;
	// if(!$stage.box.userList.is(':visible')) return;
	if ($data.opts.su) {
		arr = [];
		for (i in $data.users) {
			len++;
			arr.push($data.users[i]);
		}
		arr.sort(function (a, b) { return b.data.score - a.data.score; });
		refresh = true;
	} else {
		arr = $data.users;

		for (i in $data.users) len++;
	}
	$stage.lobby.userListTitle.html("<i class='fa fa-users'></i>"
		+ "&lt;<b>" + L['server_' + $data.server] + "</b>&gt; "
		+ L['UserList'].replace("FA{users}", "")
		+ " [" + len + L['MN'] + "]");

	if (refresh) {
		$stage.lobby.userList.empty();
		$stage.dialog.inviteList.empty();
		for (i in arr) {
			o = arr[i];
			if (o.robot) continue;

			$stage.lobby.userList.append(userListBar(o));
			if (o.place == 0) $stage.dialog.inviteList.append(userListBar(o, true));
		}
	}
}
function userListBar(o, forInvite) {
	var $R;

	if (forInvite) {
		$R = $("<div>").attr('id', "invite-item-" + o.id).addClass("invite-item users-item")
			.append($("<div>").addClass("jt-image users-image").css('background-image', "url('" + o.profile.image + "')"))
			.append(getLevelImage(o.data.score).addClass("users-level"))
			// .append($("<div>").addClass("jt-image users-from").css('background-image', "url('/img/kkutu/"+o.profile.type+".png')"))
			.append($("<div>").addClass("users-name").html(o.profile.title || o.profile.name))
			.on('click', function (e) {
				requestInvite($(e.currentTarget).attr('id').slice(12));
			});
	} else {
		$R = $("<div>").attr('id', "users-item-" + o.id).addClass("users-item")
			.append($("<div>").addClass("jt-image users-image").css('background-image', "url('" + o.profile.image + "')"))
			.append(getLevelImage(o.data.score).addClass("users-level"))
			// .append($("<div>").addClass("jt-image users-from").css('background-image', "url('/img/kkutu/"+o.profile.type+".png')"))
			.append($("<div>").addClass("users-name ellipse").html(o.profile.title || o.profile.name))
			.on('click', function (e) {
				requestProfile($(e.currentTarget).attr('id').slice(11));
			});
	}
	addonNickname($R, o);

	return $R;
}
function addonNickname($R, o) {
	if (o.equip['NIK']) $R.addClass("x-" + o.equip['NIK']);
	if (o.equip['BDG'] == "b1_gm") $R.addClass("x-gm");
}
function updateRoomList(refresh) {
	var i;
	var len = 0;

	if (!refresh) {
		$(".rooms-create").remove();
		for (i in $data.rooms) len++;
	} else {
		$stage.lobby.roomList.empty();
		for (i in $data.rooms) {
			$stage.lobby.roomList.append(roomListBar($data.rooms[i]));
			len++;
		}
	}
	$stage.lobby.roomListTitle.html(L['RoomList'].replace("FA{bars}", "<i class='fa fa-bars'></i>") + " [" + len + L['GAE'] + "]");

	if (len) {
		$(".rooms-gaming").css('display', $data.opts.ow ? "none" : "");
		$(".rooms-locked").css('display', $data.opts.ou ? "none" : "");
	} else {
		$stage.lobby.roomList.append($stage.lobby.createBanner.clone().on('click', onBanner));
	}
	function onBanner(e) {
		$stage.menu.newRoom.trigger('click');
	}
}
function roomListBar(o) {
	var $R, $ch;
	var opts = getOptions(o.mode, o.opts);

	$R = $("<div>").attr('id', "room-" + o.id).addClass("rooms-item")
		.append($ch = $("<div>").addClass("rooms-channel channel-" + o.channel).on('click', function (e) { requestRoomInfo(o.id); }))
		.append($("<div>").addClass("rooms-number").html(o.id))
		.append($("<div>").addClass("rooms-title ellipse").text(badWords(o.title)))
		.append($("<div>").addClass("rooms-limit").html(o.players.length + " / " + o.limit))
		.append($("<div>").width(270)
			.append($("<div>").addClass("rooms-mode").html(opts.join(" / ").toString()))
			.append($("<div>").addClass("rooms-round").html(L['rounds'] + " " + o.round))
			.append($("<div>").addClass("rooms-time").html(o.time + L['SECOND']))
		)
		.append($("<div>").addClass("rooms-lock").html(o.password ? "<i class='fa fa-lock'></i>" : "<i class='fa fa-unlock'></i>"))
		.on('click', function (e) {
			if (e.target == $ch.get(0)) return;
			tryJoin($(e.currentTarget).attr('id').slice(5));
		});
	if (o.gaming) $R.addClass("rooms-gaming");
	if (o.password) $R.addClass("rooms-locked");

	return $R;
}
function normalGameUserBar(o) {
	var $m, $n, $bar;
	var $R = $("<div>").attr('id', "game-user-" + o.id).addClass("game-user")
		.append($m = $("<div>").addClass("moremi game-user-image"))
		.append($("<div>").addClass("game-user-title")
			.append(getLevelImage(o.data.score).addClass("game-user-level"))
			.append($bar = $("<div>").addClass("game-user-name ellipse").html(o.profile.title || o.profile.name))
			.append($("<div>").addClass("expl").html(L['LEVEL'] + " " + getLevel(o.data.score)))
		)
		.append($n = $("<div>").addClass("game-user-score"));
	renderMoremi($m, o.equip);
	global.expl($R);
	addonNickname($bar, o);
	if (o.game.team) $n.addClass("team-" + o.game.team);

	return $R;
}
function miniGameUserBar(o) {
	var $n, $bar;
	var $R = $("<div>").attr('id', "game-user-" + o.id).addClass("game-user")
		.append($("<div>").addClass("game-user-title")
			.append(getLevelImage(o.data.score).addClass("game-user-level"))
			.append($bar = $("<div>").addClass("game-user-name ellipse").html(o.profile.title || o.profile.name))
		)
		.append($n = $("<div>").addClass("game-user-score"));
	if (o.id == $data.id) $bar.addClass("game-user-my-name");
	addonNickname($bar, o);
	if (o.game.team) $n.addClass("team-" + o.game.team);

	return $R;
}
function getAIProfile(level) {
	return {
		title: L['aiLevel' + level] + ' ' + L['robot'],
		image: "/img/kkutu/robot.png"
	};
}
function updateRoom(gaming) {
	var i, o, $r;
	var $y, $z;
	var $m;
	var $bar;
	var rule = RULE[MODE[$data.room.mode]];
	var renderer = (mobile || rule.big) ? miniGameUserBar : normalGameUserBar;
	var spec;
	var arAcc = false, allReady = true;

	setRoomHead($(".RoomBox .product-title"), $data.room);
	setRoomHead($(".GameBox .product-title"), $data.room);
	if (gaming) {
		$r = $(".GameBox .game-body").empty();
		// updateScore(true);
		for (i in $data.room.game.seq) {
			if ($data._replay) {
				o = $rec.users[$data.room.game.seq[i]] || $data.room.game.seq[i];
			} else {
				o = $data.users[$data.room.game.seq[i]] || $data.robots[$data.room.game.seq[i].id] || $data.room.game.seq[i];
			}
			if (o.robot && !o.profile) {
				o.profile = getAIProfile(o.level);
				$data.robots[o.id] = o;
			}
			$r.append(renderer(o));
			updateScore(o.id, o.game.score || 0);
		}
		clearTimeout($data._jamsu);
		delete $data._jamsu;
	} else {
		$r = $(".room-users").empty();
		spec = $data.users[$data.id].game.form == "S";
		// 참가자
		for (i in $data.room.players) {

====================================
[replace] Public 3087:3088 -> Lib 3214:3216 (BrokenFix: True)
--- Public ---
		// ?� ?�보 초기??		$data.teams = [];

--- Lib ---
		// 팀 정보 초기화
		$data.teams = [];

====================================
[replace] Public 4195:4196 -> Lib 4323:4324 (BrokenFix: False)
--- Public ---
function pushDisplay(text, mean, theme, wc, bonus) {

--- Lib ---
function pushDisplay(text, mean, theme, wc) {

====================================
[replace] Public 4234:4235 -> Lib 4362:4363 (BrokenFix: False)
--- Public ---
				if ($l.html() == $data.mission && (bonus > 0 || bonus === undefined)) {

--- Lib ---
				if ($l.html() == $data.mission) {

====================================
[replace] Public 4251:4252 -> Lib 4379:4380 (BrokenFix: False)
--- Public ---
				if (t == $data.mission && (bonus > 0 || bonus === undefined)) {

--- Lib ---
				if (t == $data.mission) {

====================================
[replace] Public 4263:4264 -> Lib 4391:4392 (BrokenFix: False)
--- Public ---
				if (t == $data.mission && (bonus > 0 || bonus === undefined)) {

--- Lib ---
				if (t == $data.mission) {

====================================
[replace] Public 4336:4337 -> Lib 4464:4465 (BrokenFix: True)
--- Public ---
	if (!_mean || _mean.indexOf("�?) == -1) return processNormal(word, _mean);

--- Lib ---
	if (!_mean || _mean.indexOf("＂") == -1) return processNormal(word, _mean);

====================================
[replace] Public 4338:4341 -> Lib 4466:4469 (BrokenFix: True)
--- Public ---
	var means = _mean.split(/�?0-9]+�?).slice(1).map(function (m1) {
		return (m1.indexOf("�?) == -1) ? [[m1]] : m1.split(/�?0-9]+�?).slice(1).map(function (m2) {
			return m2.split(/�?0-9]+�?).slice(1);

--- Lib ---
	var means = _mean.split(/＂[0-9]+＂/).slice(1).map(function (m1) {
		return (m1.indexOf("［") == -1) ? [[m1]] : m1.split(/［[0-9]+］/).slice(1).map(function (m2) {
			return m2.split(/（[0-9]+）/).slice(1);

====================================
[replace] Public 4382:4383 -> Lib 4510:4511 (BrokenFix: True)
--- Public ---
				.replace(/\\geq/g, "??)

--- Lib ---
				.replace(/\\geq/g, "≥")

====================================
[replace] Public 4573:4574 -> Lib 4701:4702 (BrokenFix: True)
--- Public ---
	return text.replace(BAD, "?�♥");

--- Lib ---
	return text.replace(BAD, "♥♥");

====================================
